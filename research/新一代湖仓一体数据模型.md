### 定义

企业现有的数据平台的构成一般由以下几部分构成：

多样业务数据源：OLTP业务，各种应用ERP数据；日志；第三方apis接入的数据等

数据ETL workflow：数据源连接与数据建模，数据清理，ETL调度任务；

数据湖存储：本地分布式文件系统，云上对象存储；

数据仓库/OLAP engine：对接各种BI，AI，机器学习分析需求

现存架构的问题：构建起来需要的组件比较多，各种顶层的分析对数据组织的要求不统一，数据存储多份等。

为了解决以上问题，我们引入了新的湖仓一体数据平台。它既不是数据仓库，亦不是数据湖，是统一BI分析和高阶分析需求的开放的一站式数据平台。即包含传统数据分析DBMS features，又提供了很多performance features ：ACID事务，数据版本，索引，缓存和良好的查询性能。即包含了传统数据湖的优势，又涵盖了数据仓库的特点。目的是替代企业现有lambda数据分析架构。

### key features

+ 事务支持

  作为企业的唯一的数据平台，同一时刻，有大量并发读和并发写的pipeline需求。支持有限的ACID，可以有效的定义pipeline之前的的隔离性和原子性。

  *隔离性：提供快照一致性读，读的pipeline只能看到已经所有已经提交的pipeline数据。*

  *原子性：一个pipeline导入多个batch数据，要么全部成功，要不全不成功；metadata和data状态的一致性*

+ ELT和schema治理：有audit机制，可以回溯任务成功和失败的信息；支持星型和雪花模型；

+ 支持BI直连：可以进行实时分析，数据不用入数仓/OLAP引擎

+ 存储和计算分离

+ 开放：标准化的列式存储格式（parquet，orc），提供各种API和分析工具让开放的机器学习等高阶工具（DataFrame 等）直接接入

+ 非结构化和半结构化的支持：数据湖嘛，支持非结构化数据和半结构化数据海量存储

+ 支持不同的workloads：data science，机器学习，SQL等；

+ 流式处理：可以消除计算存储分离结构带来的延迟影响；

+ 数据安全：权限访问控制

+ 监控

![湖仓一体架构图](\湖仓一体架构图.png)

<center>湖仓一体架构图</center>

### 导图

[思维导图链接](https://github.com/kafka1991/lakehouseResearch/blob/master/picture/%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93%E6%9E%B6%E6%9E%84%E5%9B%BE.png)

其中重要功能点已经加粗，第一版本需要完成

### 技术选型与调研

#### 存储层

本地（on premise）部署时，需要选择一个分布式文件系统作为底层；

HDFS?minio?还是其他存储系统？

需要从功能完整，部署难度，运维（扩容、缩容），性能综合对比分析；

#### 语义层（table format）

apache iceberg怎么样？需要综合调研一下；

#### ELT workflow支持

有什么好的落地方式

#### 查询引擎

spark3.0性能如何？是否需要用c++重新开发一个？还是像TIDB一样借助于clickhouse的执行语义层，加上定制开发；

#### 开放的列存格式哪个更好

parquet，orc等

#### 完善的权限系统

用户、角色、组的落地方案
